@model EnableAuthenticatorViewModel
@{
    ViewData["Title"] = "Enable Two-Factor Authentication";
    ViewData.AddActivePage(ManageNavPages.TwoFactorAuthentication);
}

<div class="identity-server-dashboard">
    <!-- Page Header -->
    <div class="dashboard-header">
        <div class="flex items-center space-x-3">
            <div class="avatar">
                <div class="w-12 h-12 rounded-full bg-gradient-to-br from-success to-info">
                    <i class="fas fa-mobile-alt text-white flex items-center justify-center h-full"></i>
                </div>
            </div>
            <div>
                <h1 class="dashboard-title">Enable Two-Factor Authentication</h1>
                <p class="dashboard-subtitle">Add an extra layer of security to your account</p>
            </div>
        </div>
    </div>

    <div class="grid grid-cols-1 lg:grid-cols-3 gap-8">
        <!-- Main Setup Process -->
        <div class="lg:col-span-2">
            <div class="card bg-base-100 shadow-xl border border-base-300">
                <div class="card-body">
                    <h2 class="card-title text-2xl mb-6">
                        <i class="fas fa-shield-alt mr-2"></i>
                        Setup Process
                    </h2>

                    <!-- Step 1: Download App -->
                    <div class="collapse collapse-plus bg-base-200 mb-4">
                        <input type="radio" name="setup-accordion" checked />
                        <div class="collapse-title text-lg font-medium">
                            <div class="flex items-center space-x-3">
                                <div class="badge badge-primary">1</div>
                                <span>Download Authenticator App</span>
                            </div>
                        </div>
                        <div class="collapse-content">
                            <div class="pt-4">
                                <p class="mb-4">Choose and download a two-factor authentication app:</p>
                                
                                <div class="grid grid-cols-1 sm:grid-cols-2 gap-4">
                                    <!-- Microsoft Authenticator -->
                                    <div class="card bg-base-100 border border-base-300">
                                        <div class="card-body p-4">
                                            <div class="flex items-center space-x-3 mb-3">
                                                <i class="fab fa-microsoft text-blue-600 text-2xl"></i>
                                                <div>
                                                    <h4 class="font-semibold">Microsoft Authenticator</h4>
                                                    <p class="text-xs text-base-content/70">Recommended</p>
                                                </div>
                                            </div>
                                            <div class="flex space-x-2">
                                                <a href="https://go.microsoft.com/fwlink/?Linkid=825072" target="_blank" class="btn btn-outline btn-xs flex-1">
                                                    <i class="fab fa-android mr-1"></i>
                                                    Android
                                                </a>
                                                <a href="https://go.microsoft.com/fwlink/?Linkid=825073" target="_blank" class="btn btn-outline btn-xs flex-1">
                                                    <i class="fab fa-apple mr-1"></i>
                                                    iOS
                                                </a>
                                            </div>
                                        </div>
                                    </div>

                                    <!-- Google Authenticator -->
                                    <div class="card bg-base-100 border border-base-300">
                                        <div class="card-body p-4">
                                            <div class="flex items-center space-x-3 mb-3">
                                                <i class="fab fa-google text-red-600 text-2xl"></i>
                                                <div>
                                                    <h4 class="font-semibold">Google Authenticator</h4>
                                                    <p class="text-xs text-base-content/70">Popular choice</p>
                                                </div>
                                            </div>
                                            <div class="flex space-x-2">
                                                <a href="https://play.google.com/store/apps/details?id=com.google.android.apps.authenticator2&hl=en" target="_blank" class="btn btn-outline btn-xs flex-1">
                                                    <i class="fab fa-android mr-1"></i>
                                                    Android
                                                </a>
                                                <a href="https://itunes.apple.com/us/app/google-authenticator/id388497605?mt=8" target="_blank" class="btn btn-outline btn-xs flex-1">
                                                    <i class="fab fa-apple mr-1"></i>
                                                    iOS
                                                </a>
                                            </div>
                                        </div>
                                    </div>
                                </div>
                            </div>
                        </div>
                    </div>

                    <!-- Step 2: Scan QR Code -->
                    <div class="collapse collapse-plus bg-base-200 mb-4">
                        <input type="radio" name="setup-accordion" />
                        <div class="collapse-title text-lg font-medium">
                            <div class="flex items-center space-x-3">
                                <div class="badge badge-primary">2</div>
                                <span>Scan QR Code or Enter Key</span>
                            </div>
                        </div>
                        <div class="collapse-content">
                            <div class="pt-4">
                                <div class="grid grid-cols-1 lg:grid-cols-2 gap-6">
                                    <!-- QR Code -->
                                    <div class="text-center">
                                        <h4 class="font-semibold mb-4">Scan with your app</h4>
                                        <div class="bg-white p-4 rounded-lg inline-block border">
                                            <div id="qrCode" class="flex items-center justify-center min-h-[200px]">
                                                <div class="loading loading-spinner loading-lg"></div>
                                            </div>
                                        </div>
                                        <div id="qrCodeData" data-url="@Html.Raw(Model.AuthenticatorUri)" class="hidden"></div>
                                    </div>

                                    <!-- Manual Entry -->
                                    <div>
                                        <h4 class="font-semibold mb-4">Or enter manually</h4>
                                        <div class="form-control">
                                            <label class="label">
                                                <span class="label-text">Account Name</span>
                                            </label>
                                            <input type="text" value="Spydersoft Identity" class="input input-bordered" readonly />
                                        </div>
                                        <div class="form-control mt-3">
                                            <label class="label">
                                                <span class="label-text">Secret Key</span>
                                            </label>
                                            <div class="flex space-x-2">
                                                <input type="text" value="@Model.SharedKey" class="input input-bordered flex-1" readonly id="secretKey" />
                                                <button class="btn btn-outline" data-copy-target="secretKey">
                                                    <i class="fas fa-copy"></i>
                                                </button>
                                            </div>
                                            <label class="label">
                                                <span class="label-text-alt">Spaces and casing don't matter</span>
                                            </label>
                                        </div>
                                    </div>
                                </div>
                            </div>
                        </div>
                    </div>

                    <!-- Step 3: Verify -->
                    <div class="collapse collapse-plus bg-base-200">
                        <input type="radio" name="setup-accordion" />
                        <div class="collapse-title text-lg font-medium">
                            <div class="flex items-center space-x-3">
                                <div class="badge badge-primary">3</div>
                                <span>Verify Setup</span>
                            </div>
                        </div>
                        <div class="collapse-content">
                            <div class="pt-4">
                                <p class="mb-6">Enter the 6-digit code from your authenticator app to complete setup:</p>
                                
                                <form method="post" class="max-w-md">
                                    @if (!ViewData.ModelState.IsValid)
                                    {
                                        <div class="alert alert-error mb-6">
                                            <i class="fas fa-exclamation-triangle"></i>
                                            <div asp-validation-summary="All" class="text-sm"></div>
                                        </div>
                                    }

                                    <div class="form-control w-full">
                                        <label class="label">
                                            <span class="label-text font-medium">@Html.DisplayNameFor(m => m.Code)</span>
                                        </label>
                                        <input asp-for="Code" 
                                               type="text" 
                                               class="input input-bordered text-center text-2xl tracking-widest" 
                                               placeholder="000000"
                                               maxlength="6"
                                               autocomplete="off" />
                                        <label class="label">
                                            <span asp-validation-for="Code" class="label-text-alt text-error"></span>
                                            <span class="label-text-alt">Enter the 6-digit code</span>
                                        </label>
                                    </div>

                                    <div class="flex space-x-3 mt-6">
                                        <button type="submit" class="btn btn-primary btn-lg flex-1">
                                            <i class="fas fa-check mr-2"></i>
                                            Verify & Enable
                                        </button>
                                        <a asp-action="TwoFactorAuthentication" class="btn btn-outline">
                                            Cancel
                                        </a>
                                    </div>
                                </form>
                            </div>
                        </div>
                    </div>
                </div>
            </div>
        </div>

        <!-- Information Sidebar -->
        <div class="space-y-6">
            <!-- Security Benefits -->
            <div class="card bg-base-100 shadow-xl border border-base-300">
                <div class="card-body">
                    <h3 class="card-title text-lg mb-4">
                        <i class="fas fa-shield-check mr-2 text-success"></i>
                        Security Benefits
                    </h3>
                    <ul class="space-y-3 text-sm">
                        <li class="flex items-start space-x-2">
                            <i class="fas fa-check text-success text-xs mt-1"></i>
                            <span>Prevents unauthorized access even if your password is compromised</span>
                        </li>
                        <li class="flex items-start space-x-2">
                            <i class="fas fa-check text-success text-xs mt-1"></i>
                            <span>Works offline - no internet required to generate codes</span>
                        </li>
                        <li class="flex items-start space-x-2">
                            <i class="fas fa-check text-success text-xs mt-1"></i>
                            <span>Industry standard time-based authentication</span>
                        </li>
                        <li class="flex items-start space-x-2">
                            <i class="fas fa-check text-success text-xs mt-1"></i>
                            <span>Easy to use and highly secure</span>
                        </li>
                    </ul>
                </div>
            </div>

            <!-- Backup Codes Info -->
            <div class="card bg-base-100 shadow-xl border border-base-300">
                <div class="card-body">
                    <h3 class="card-title text-lg mb-4">
                        <i class="fas fa-key mr-2 text-warning"></i>
                        Recovery Codes
                    </h3>
                    <p class="text-sm text-base-content/80 mb-4">
                        After enabling 2FA, you'll receive backup recovery codes. Keep these safe!
                    </p>
                    <div class="space-y-2 text-sm">
                        <div class="flex items-center space-x-2">
                            <i class="fas fa-download text-info text-xs"></i>
                            <span>Download and store securely</span>
                        </div>
                        <div class="flex items-center space-x-2">
                            <i class="fas fa-print text-info text-xs"></i>
                            <span>Print and keep in a safe place</span>
                        </div>
                        <div class="flex items-center space-x-2">
                            <i class="fas fa-eye-slash text-info text-xs"></i>
                            <span>Each code can only be used once</span>
                        </div>
                    </div>
                </div>
            </div>

            <!-- Quick Actions -->
            <div class="card bg-base-100 shadow-xl border border-base-300">
                <div class="card-body">
                    <h3 class="card-title text-lg mb-4">
                        <i class="fas fa-cog mr-2"></i>
                        Account Settings
                    </h3>
                    <div class="space-y-2">
                        <a asp-action="TwoFactorAuthentication" class="btn btn-ghost btn-sm w-full justify-start">
                            <i class="fas fa-arrow-left mr-2"></i>
                            Back to 2FA Settings
                        </a>
                        <a asp-action="Index" class="btn btn-ghost btn-sm w-full justify-start">
                            <i class="fas fa-user mr-2"></i>
                            Profile Settings
                        </a>
                        <a asp-action="ChangePassword" class="btn btn-ghost btn-sm w-full justify-start">
                            <i class="fas fa-key mr-2"></i>
                            Change Password
                        </a>
                    </div>
                </div>
            </div>
        </div>
    </div>
</div>

@section Scripts {
    @await Html.PartialAsync("_ValidationScriptsPartial")
    <script type="text/javascript" src="~/lib/davidshimjs-qrcodejs/qrcode.js"></script>
}
