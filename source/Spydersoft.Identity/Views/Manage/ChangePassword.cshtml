@model ChangePasswordViewModel
@{
    ViewData["Title"] = "Change Password";
    ViewData.AddActivePage(ManageNavPages.ChangePassword);
}

<div class="identity-server-dashboard">
    <!-- Page Header -->
    <div class="dashboard-header">
        <div class="flex items-center space-x-3">
            <div class="avatar">
                <div class="w-12 h-12 rounded-full bg-gradient-to-br from-warning to-error">
                    <i class="fas fa-key text-white flex items-center justify-center h-full"></i>
                </div>
            </div>
            <div>
                <h1 class="dashboard-title">Change Password</h1>
                <p class="dashboard-subtitle">Update your account password for better security</p>
            </div>
        </div>
    </div>

    <!-- Status Message -->
    @if (!string.IsNullOrEmpty(Model.StatusMessage))
    {
        <div class="alert alert-success mb-8">
            <i class="fas fa-check-circle"></i>
            <span>@Model.StatusMessage</span>
        </div>
    }

    <div class="grid grid-cols-1 lg:grid-cols-3 gap-8">
        <!-- Password Form -->
        <div class="lg:col-span-2">
            <div class="card bg-base-100 shadow-xl border border-base-300">
                <div class="card-body">
                    <div class="flex items-center space-x-3 mb-6">
                        <div class="avatar">
                            <div class="w-10 h-10 rounded-full bg-warning/10">
                                <i class="fas fa-lock text-warning flex items-center justify-center h-full"></i>
                            </div>
                        </div>
                        <div>
                            <h2 class="card-title text-xl">Update Password</h2>
                            <p class="text-base-content/70">Choose a strong, unique password</p>
                        </div>
                    </div>

                    <form method="post" class="space-y-6">
                        <!-- Validation Summary -->
                        @if (!ViewData.ModelState.IsValid)
                        {
                            <div class="alert alert-error">
                                <i class="fas fa-exclamation-triangle"></i>
                                <div>
                                    <h3 class="font-bold">Validation Error</h3>
                                    <div asp-validation-summary="All" class="text-sm"></div>
                                </div>
                            </div>
                        }

                        <!-- Current Password -->
                        <div class="form-control w-full">
                            <label class="label">
                                <span class="label-text font-medium">@Html.DisplayNameFor(m => m.OldPassword)</span>
                                <span class="label-text-alt text-error">*</span>
                            </label>
                            <div class="relative">
                                <input asp-for="OldPassword" 
                                       type="password" 
                                       class="input input-bordered w-full pr-10 focus:input-primary" 
                                       placeholder="Enter your current password" />
                                <button type="button" 
                                        class="absolute inset-y-0 right-0 pr-3 flex items-center"
                                        onclick="togglePassword(this, 'OldPassword')">
                                    <i class="fas fa-eye text-base-content/40 hover:text-base-content cursor-pointer"></i>
                                </button>
                            </div>
                            <label class="label">
                                <span asp-validation-for="OldPassword" class="label-text-alt text-error"></span>
                            </label>
                        </div>

                        <!-- New Password -->
                        <div class="form-control w-full">
                            <label class="label">
                                <span class="label-text font-medium">@Html.DisplayNameFor(m => m.NewPassword)</span>
                                <span class="label-text-alt text-error">*</span>
                            </label>
                            <div class="relative">
                                <input asp-for="NewPassword" 
                                       type="password" 
                                       class="input input-bordered w-full pr-10 focus:input-primary" 
                                       placeholder="Create a new password" />
                                <button type="button" 
                                        class="absolute inset-y-0 right-0 pr-3 flex items-center"
                                        onclick="togglePassword(this, 'NewPassword')">
                                    <i class="fas fa-eye text-base-content/40 hover:text-base-content cursor-pointer"></i>
                                </button>
                            </div>
                            <label class="label">
                                <span asp-validation-for="NewPassword" class="label-text-alt text-error"></span>
                                <span class="label-text-alt text-base-content/60">Minimum 8 characters with mixed case, numbers, and symbols</span>
                            </label>
                        </div>

                        <!-- Confirm Password -->
                        <div class="form-control w-full">
                            <label class="label">
                                <span class="label-text font-medium">@Html.DisplayNameFor(m => m.ConfirmPassword)</span>
                                <span class="label-text-alt text-error">*</span>
                            </label>
                            <div class="relative">
                                <input asp-for="ConfirmPassword" 
                                       type="password" 
                                       class="input input-bordered w-full pr-10 focus:input-primary" 
                                       placeholder="Confirm your new password" />
                                <button type="button" 
                                        class="absolute inset-y-0 right-0 pr-3 flex items-center"
                                        onclick="togglePassword(this, 'ConfirmPassword')">
                                    <i class="fas fa-eye text-base-content/40 hover:text-base-content cursor-pointer"></i>
                                </button>
                            </div>
                            <label class="label">
                                <span asp-validation-for="ConfirmPassword" class="label-text-alt text-error"></span>
                            </label>
                        </div>

                        <!-- Submit Button -->
                        <div class="card-actions justify-end">
                            <a asp-action="Index" class="btn btn-outline">
                                <i class="fas fa-arrow-left mr-2"></i>
                                Cancel
                            </a>
                            <button type="submit" class="btn btn-primary btn-lg">
                                <i class="fas fa-shield-alt mr-2"></i>
                                Update Password
                            </button>
                        </div>
                    </form>
                </div>
            </div>
        </div>

        <!-- Security Tips Sidebar -->
        <div class="space-y-6">
            <!-- Password Requirements -->
            <div class="card bg-base-100 shadow-xl border border-base-300">
                <div class="card-body">
                    <h3 class="card-title text-lg mb-4">
                        <i class="fas fa-shield-alt mr-2 text-success"></i>
                        Password Requirements
                    </h3>
                    <ul class="space-y-2 text-sm">
                        <li class="flex items-center space-x-2">
                            <i class="fas fa-check text-success text-xs"></i>
                            <span>At least 8 characters long</span>
                        </li>
                        <li class="flex items-center space-x-2">
                            <i class="fas fa-check text-success text-xs"></i>
                            <span>Contains uppercase letters</span>
                        </li>
                        <li class="flex items-center space-x-2">
                            <i class="fas fa-check text-success text-xs"></i>
                            <span>Contains lowercase letters</span>
                        </li>
                        <li class="flex items-center space-x-2">
                            <i class="fas fa-check text-success text-xs"></i>
                            <span>Contains numbers</span>
                        </li>
                        <li class="flex items-center space-x-2">
                            <i class="fas fa-check text-success text-xs"></i>
                            <span>Contains special characters</span>
                        </li>
                    </ul>
                </div>
            </div>

            <!-- Security Tips -->
            <div class="card bg-base-100 shadow-xl border border-base-300">
                <div class="card-body">
                    <h3 class="card-title text-lg mb-4">
                        <i class="fas fa-lightbulb mr-2 text-info"></i>
                        Security Tips
                    </h3>
                    <ul class="space-y-3 text-sm text-base-content/80">
                        <li class="flex items-start space-x-2">
                            <i class="fas fa-star text-warning text-xs mt-1"></i>
                            <span>Use a unique password that you don't use elsewhere</span>
                        </li>
                        <li class="flex items-start space-x-2">
                            <i class="fas fa-star text-warning text-xs mt-1"></i>
                            <span>Consider using a password manager</span>
                        </li>
                        <li class="flex items-start space-x-2">
                            <i class="fas fa-star text-warning text-xs mt-1"></i>
                            <span>Enable two-factor authentication</span>
                        </li>
                        <li class="flex items-start space-x-2">
                            <i class="fas fa-star text-warning text-xs mt-1"></i>
                            <span>Update passwords regularly</span>
                        </li>
                    </ul>
                </div>
            </div>

            <!-- Quick Actions -->
            <div class="card bg-base-100 shadow-xl border border-base-300">
                <div class="card-body">
                    <h3 class="card-title text-lg mb-4">
                        <i class="fas fa-cog mr-2"></i>
                        Security Settings
                    </h3>
                    <div class="space-y-2">
                        <a asp-action="TwoFactorAuthentication" class="btn btn-ghost btn-sm w-full justify-start">
                            <i class="fas fa-mobile-alt mr-2"></i>
                            Two-Factor Auth
                        </a>
                        <a asp-action="ExternalLogins" class="btn btn-ghost btn-sm w-full justify-start">
                            <i class="fas fa-link mr-2"></i>
                            External Logins
                        </a>
                        <a asp-action="Index" class="btn btn-ghost btn-sm w-full justify-start">
                            <i class="fas fa-user mr-2"></i>
                            Back to Profile
                        </a>
                    </div>
                </div>
            </div>
        </div>
    </div>
</div>

@section Scripts {
    @await Html.PartialAsync("_ValidationScriptsPartial")
    
    <script>
        function togglePassword(button, fieldName) {
            const input = document.getElementById(fieldName);
            const icon = button.querySelector('i');
            
            if (input.type === 'password') {
                input.type = 'text';
                icon.classList.remove('fa-eye');
                icon.classList.add('fa-eye-slash');
            } else {
                input.type = 'password';
                icon.classList.remove('fa-eye-slash');
                icon.classList.add('fa-eye');
            }
        }
    </script>
}
